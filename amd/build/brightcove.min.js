define ("mod_html5player/brightcove",["jquery","core/ajax"],function(a,b){var c,d,e=function(a,b){window.require.config({paths:{bc:"https://players.brightcove.net/".concat(a,"/").concat(b,"_default/index.min")},waitSeconds:30})},f=function(a,b){var d=b.cmid,e=b.video_id;a.on("play",function(){e=a.mediainfo.id;console.info("Video: ".concat(a.mediainfo.id," started playing..."));c=a.setInterval(function(){var c=Math.ceil(a.currentTime());console.log("Video playing. Total length: ".concat(a.duration(),". Video current progress is : ").concat(a.currentTime()));h(b,d,e,c)},+b.progress_interval)});a.on("pause",function(){a.clearInterval(c)})},g=function(a,b){var c=null===b||void 0===b?void 0:b.progress;if(c){var d=a.duration(),e=Math.floor(c)/1e3;console.info("Duration is: ".concat(d," and Video progress is ").concat(e," seconds"));if(d>=e){a.currentTime(e)}}else{console.info("Video progress is ".concat(c))}},h=function(a,c,d,e){var f=4<arguments.length&&arguments[4]!==void 0?arguments[4]:!1,g;g=b.call([{methodname:"mod_html5player_set_module_progress",args:{id:c,videoid:d,progress:e,ended:f}}]);g[0].then(function(b){console.info("Video completed : ".concat(b.completed));if(b.completed){var d=new CustomEvent("core_course:manualcompletiontoggled",{bubbles:!0,detail:{id:c,activityname:a.name,completed:b.completed,withAvailability:""}});document.dispatchEvent(d)}}).fail(function(a){console.log(a)})},i=function(a,c){var d;console.info("Geting course video progress from store...");d=b.call([{methodname:"mod_html5player_get_module_progress",args:{id:c.cmid,videoid:c.video_id}}]);d[0].then(function(b){console.info("Fetched result from store");g(a,b)}).fail(function(a){console.log(a)})},j=function(a,c){var e;console.info("Getting course video progresses from store...");e=b.call([{methodname:"mod_html5player_get_module_progresses",args:{id:c.cmid}}]);e[0].then(function(b){var c;console.info("Fetched module progresses result from store");if(0<(null===(c=b.progresses)||void 0===c?void 0:c.length)){var e=a.playlist(),f;if(d){console.info("Current item progress set after first time dom load...");f=b.progresses[0];var j=e.findIndex(function(a){return a.id==f.video_id});if(0<=j){a.playlist.currentItem(j);g(a,f);d=!1}}else{var h=a.playlist.currentItem(),i=e[h];f=b.progresses.find(function(a){return a.video_id==i.id});g(a,f)}}}).fail(function(a){console.log(a)})},k=function(a,b){a.on("loadedmetadata",function(){console.info("Single video player meta data loaded...");i(a,b)})},l=function(a,b){f(a,b);a.on("ended",function(){var d=Math.ceil(a.duration());console.log("Video ended... Video id: ".concat(a.mediainfo.id,", Duration: ").concat(a.duration()));h(b,b.cmid,b.video_id,d,!0);a.clearInterval(c)})},m=function(a,b){a.on("loadedmetadata",function(){console.info("playlist videos player meta data loaded...");j(a,b)})},n=function(a,b){f(a,b);a.on("beforeplaylistitem",function(){console.log("Event: beforeplaylistitem -> Switching to new video ...");a.clearInterval(c)});a.on("ended",function(){var d=Math.ceil(a.duration());console.log("Video ended...");h(b,b.cmid,a.mediainfo.id,d,!0);a.clearInterval(c);var e=a.playlist.next();console.info("Start playing to next video : ".concat(e.id))})};return{init:function initBrightCovePlayer(a){a=JSON.parse(a);e(a.account_id,a.player_id);require(["bc"],function(){console.info("Brightcove player js loaded...");if(a.is_student){var b=videojs.getPlayer("brightcove-player-".concat(a.player_id));if(a.video_type==1){console.info("User is a student and Video type single video...");k(b,a);l(b,a)}else if(a.video_type==2){console.info("User is a student and Video type playlists video...");m(b,a);d=!0;n(b,a)}}})}}});
//# sourceMappingURL=brightcove.min.js.map
